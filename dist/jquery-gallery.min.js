/*! jQuery Gallery - v0.1.0 - 2012-12-13
* https://github.com/swallentin/jquery-gallery
* Copyright (c) 2012 swallentin; Licensed MIT, GPL */
(function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=c;var d=this,e=function(b){a.each(b.items,function(a,b){b.media.m=b.media.m.replace("_m","_z");if(c.viewerTemplate){var e=c.viewerTemplate({url:b.media.m,heading:b.title,description:b.description});d.$element.find(".viewer").append(e)}if(c.thumbnailTemplate){var f=c.thumbnailTemplate({url:b.media.m,target:"#"+d.$element.attr("id")});d.$element.find(".thumbnails").append(f)}}),d.$element.find(".thumbnails img").parent().addClass("loading"),d.$element.find(".thumbnails").imagesLoaded().progress(function(b,c,d,e){a(this).parent().removeClass("loading")}).fail(function(){a(this).parent().removeClass("loading"),a(this).parent().addClass("fail")}).done(function(){}),c.effects&&c.effects(d.$element),d.to(0)};a.getJSON(c.url,{format:"json"},e)};b.prototype={to:function(a){var b=this.activePosition(),c=a>b?"next":"previous";return this.update(c,a)},update:function(b,c){if(c==this.activePosition()||this.sliding)return;var d=this.$element.find(".viewer"),e=this.$element.find(".thumbnails"),f=a(d.children()),g=a(e.children()),h=a(f[c]),i=a(g[c]),j=d.find(".active"),k=b=="next"?"left":"right",l=this;this.sliding=!0;if(h.hasClass("active"))return;return a.support.transition?(h.addClass(b),h[0].offsetWidth,j.addClass(k),h.addClass(k),this.$element.one(a.support.transition.end,function(){h.removeClass([b,k].join(" ")).addClass("active"),j.removeClass("active"),j.removeClass(k),g.removeClass("active").stop().fadeTo(500,.5),i.addClass("active").stop().fadeTo(500,1),l.sliding=!1})):a(".viewer .item.active").fadeTo(500,0,function(){f.removeClass("active"),h.addClass("active").fadeTo(500,1),l.sliding=!1}),this},next:function(){var a=this.activePosition()+1;return a>=this.numberOfItems()&&(a=0),this.update("next",a)},previous:function(){var a=this.activePosition()-1;return a<=0&&(a=this.numberOfItems()-1),this.update("previous",a)},activePosition:function(){var a=this.$element.find(".viewer"),b=a.find(".active"),c=a.children(),d=c.index(b);return d},numberOfItems:function(){return this.$element.find(".viewer").children().length}},a.fn.gallery=function(c){return this.each(function(){var d=a(this),e=d.data("gallery"),f=a.extend({},a.fn.gallery.defaults,typeof c=="object"&&c);e||d.data("gallery",e=new b(this,f)),typeof c=="number"&&e.to(c),typeof c=="string"&&e[c]()})},a.fn.gallery.defaults={viewerTemplate:function(a){return""},thumbnailTemplate:function(a){return""}},a.fn.gallery.Constructor=b,a(function(){a("body").on("click.gallery.navigate","[data-action]",function(b){var c=a(this),d,e=a(d=c.attr("data-element")),f=c.attr("data-action"),g=f;if(f=="to"){var h=a(this),i=h.parent().children(),j=i.index(h);g=j}e.gallery(g),b.preventDefault()})})})(jQuery);